version: '1'
name: debug
vars:
tasks:
  user_sql:
    executor: sql
    clients: [client1]
    payload: |
      {
        "driver": "mysql",
        "host": "127.0.0.1",
        "port": "3306",
        "user": "nghia",
        "password": "root",
        "dbname": "workflow"
      }

brokers:
  brok:
    listens: [a_channel]
    flows: |
      {{get .a_channel ("content") | get ("msg")  
          | .data | parse | get ("user_id") | .user_id }}{{end}}
      {{printf ("select *  from users where id = %v") .user_id 
          | .sql_user }}
      {{define .req map | put ("sql") .sql_user | .req }}{{end}}
      {{sendsync .req  .user_sql_task | .result }}
      {{get .result ("result") |  get ("output") | getp (0) | return }}{{end}}